{% extends "base.html.j2" %}
{% import "macro.html.j2" as macro %}

{% block styles %}
    {{ super() }}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/notes.css') }}">

{% endblock %}


{% block content %}
    {{ macro.flash() }}
    <div class="row">
        <div class="col-md-2" style="padding-top: 50px;">

            <input type="text" id="myInput" onkeyup="myFunction()" placeholder="Search Your Categories"
                   title="Type in a name">

            <ul id="myUL">
                <li><a href="#">Adele</a></li>
                <li><a href="#">Agnes</a></li>

                <li><a href="#">Billy</a></li>
                <li><a href="#">Bob</a></li>

                <li><a href="#">Calvin</a></li>
                <li><a href="#">Christina</a></li>
                <li><a href="#">Cindy</a></li>
            </ul>

        </div>
        <div class="col-md-10">
            <div class="notes" style="padding-top:20px;" id="all_notes">

                {% for note in notes %}

                    <div class="note">
                        <div class="note-inner">
                            {% if note.isprivate %}
                                <div class="box-icon" style="background-color:green;">
                                    <span class="fas fa-2x fa-lock"></span>
                                </div>
                            {% else %}
                                <div class="box-icon" style="background-color:red;">
                                    <span class="fas fa-2x fa-unlock"></span>
                                </div>
                            {% endif %}
                            <br>
                            <h4 class="text-center title" id="t{{ note.id }}">{{ note.title|e }}</h4>
                            <span id="b{{ note.id }}" hidden>{{ note.content|e }}</span>
                            <span class="content"
                                  style="white-space: pre-wrap;">{{ note.content|e|linkify|markdown }}</span>
                            <span value="{{ note.isprivate }}" id="p{{ note.id }}" hidden></span>
                            <span class="categories"
                                  id="c{{ note.id }}">#{{ note.categories | join(' #') | trim | e }}</span>
                            {% if edit_form is not none %}
                                <ul class="delete-edit-button" style="float:right;">
                                    <li><a style="color:#343a40;" href="#editModal" data-toggle="modal"
                                           data-whatever="{{ note.id }}"><span class="far fa-2x fa-edit"></span></a>
                                    </li>
                                    <li><a style="color:#343a40;" href="#deleteModal" data-toggle="modal"
                                           data-whatever="{{ note.id }}"><span
                                            class="far fa-2x fa-trash-alt"></span></a>
                                    </li>
                                </ul>
                            {% endif %}
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>
    </div>
    {% if edit_form is not none %}
        <a href="#createModal" data-toggle="modal">
            <button class="big-add show-add-note"><span class="fas fa-pencil-alt"></span></button>
        </a>
    {% endif %}

{% endblock %}
{% if edit_form is not none %}
    {% block createmodal %}
        {{ macro.createmodal(edit_form) }}
    {% endblock %}
    {% block editmodel %}
        {{ macro.editmodal(edit_form) }}
    {% endblock %}
    {% block deletemodal %}
        {{ macro.deletemodal(delete_form) }}
    {% endblock %}
{% endif %}
{% block scripts %}
    {{ super() }}
    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/2.2.1/isotope.pkgd.js'></script>
    {% if edit_form is not none %}
        <script type="text/javascript">


            $('#editModal').on('show.bs.modal', function (event) {

                function unescapeHtml(safe) {
                    return safe.replace(/&amp;/g, '&')
                        .replace(/&lt;/g, '<')
                        .replace(/&gt;/g, '>')
                        .replace(/&quot;/g, '"')
                        .replace(/&#039;/g, "'");
                }

                let button = $(event.relatedTarget)
                let id = button.data('whatever')
                let title = document.getElementById("t" + id).innerHTML;
                let body = document.getElementById("b" + id).innerHTML;
                let privacy = document.getElementById("p" + id).getAttribute("value");
                let categories = document.getElementById("c" + id).innerHTML;
                let modal = $(this);
                modal.find('#edit-title').val(unescapeHtml(title));
                modal.find('#edit-note').val(unescapeHtml(body));
                modal.find('#edit-id').val(id);

                modal.find('#edit-category').val(unescapeHtml(categories));
                if (privacy === "True") {
                    modal.find('#edit-privacy-toggle').addClass("active");
                    modal.find('#edit-isprivate').prop('checked', true);

                }
                else {
                    modal.find('#edit-privacy-toggle').removeClass("active");
                    modal.find('#edit-isprivate').prop('checked', false);

                }
                modal.find('#edit-privacy-toggle').click(function () {
                    var checked = modal.find('#edit-isprivate').prop('checked');
                    modal.find('#edit-isprivate').prop('checked', !checked);
                });
            });
        </script>
        <script type="text/javascript">

            function textFilter() {
                var input = document.getElementById("myInput");
                var filter = input.value;
                var content = $(this).find('span.content').text();
                var categories = $(this).find('span.categories').text();
                var titles = $(this).find('h4.title').text();
                console.log(content);
                return content.indexOf(filter) > -1 || categories.indexOf(filter) > -1 || titles.indexOf(filter) > -1;
            }

            function myFunction() {
                $('#all_notes').isotope({filter: textFilter});
            }
        </script>

    {% endif %}
{% endblock %}

